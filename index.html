<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Electric Vehicle Narrative Visualization</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        .scene {
            display: none;
            text-align: center;
        }
        .active {
            display: block;
        }
        .navigation {
            margin: 20px;
            font-size: large;
            text-align: center;
        }
        #tooltip {
            position: absolute;
            background: lightgray;
            padding: 5px;
            border-radius: 3px;
            pointer-events: none;
            font-size: 12px;
        }
        .legend {
            font-size: 12px;
            text-anchor: start;
        }
        .legend rect {
            stroke: #000;
            stroke-width: 1px;
        }
        .filter-container {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Electric Vehicles</h1>
    <div id="scene1" class="scene active">
        <h2>Scene 1: Counts of Vehicles by Model Year</h2>
    </div>
    <div id="scene2" class="scene">
        <h2>Scene 2: Electric Range Analysis by Make</h2>
    </div>
    <div id="scene3" class="scene">
        <h2>Scene 3: Overview of Electric Vehicle Trends</h2>
    </div>
    <div id="exploration" class="scene">
        <h2>Exploration: Interactive Dashboard</h2>
        <div class="filter-container">
            <label for="x-axis">X-axis:</label>
            <select id="x-axis">
                <option value="ModelYear">Model Year</option>
                <option value="ElectricRange">Electric Range</option>
                <option value="Make">Make</option>
                <option value="ElectricVehicleType">Electric Vehicle Type</option>
                <option value="Model">Model</option>
            </select>

            <label for="y-axis">Y-axis:</label>
            <select id="y-axis">
                <option value="ModelYear">Model Year</option>
                <option value="ElectricRange">Electric Range</option>
                <option value="Make">Make</option>
                <option value="ElectricVehicleType">Electric Vehicle Type</option>
                <option value="Model">Model</option>
            </select>

            <label for="year-range">Model Year Range:</label>
            <input type="range" id="year-range" min="2000" max="2024" step="1" multiple>

            <label for="range-slider">Electric Range:</label>
            <input type="range" id="range-slider" min="0" max="400" step="1" multiple>

            <label for="make-dropdown">Make:</label>
            <select id="make-dropdown" multiple>
                <!-- Options will be populated dynamically -->
            </select>

            <label for="type-dropdown">Electric Vehicle Type:</label>
            <select id="type-dropdown" multiple>
                <option value="BEV">BEV</option>
                <option value="PHEV">PHEV</option>
            </select>

            <label for="model-dropdown">Model:</label>
            <select id="model-dropdown" multiple>
                <!-- Options will be populated dynamically -->
            </select>
        </div>
        <svg id="exploration-chart" width="960" height="500"></svg>
    </div>
    <div class="navigation">
        <button id="prevBtn" onclick="prevScene()">Previous</button>
        <button id="nextBtn" onclick="nextScene()">Next</button>
    </div>
    <div id="tooltip" style="position: absolute; background: lightgray; padding: 5px; border-radius: 3px; display: none;"></div>
    <script src=""></script>
    <script>
        // Load data and initialize visualization
        d3.csv('Sampled_Small_EV_Data.csv').then(data => {
            // Parse data
            data.forEach(d => {
                d.ModelYear = +d['Model Year'];
                d.ElectricRange = +d['Electric Range'];
                d.Make = d.Make;
                d.Model = d.Model;
                d.ElectricVehicleType = d['Electric Vehicle Type'];
                d.CAFVEligibility = d['Clean Alternative Fuel Vehicle (CAFV) Eligibility'];
            });
            const margin = {top: 20, right: 150, bottom: 40, left: 100},
                  width = 1280 - margin.left - margin.right,
                  height = 600 - margin.top - margin.bottom;

            // Scene 1: Overview of Electric Vehicle Trends            
            const scene1 = d3.select("#scene1");

            const svg1 = scene1.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            const mapVehicleType = (type) => {
                if (type.includes('Battery Electric Vehicle')) return 'EV';
                if (type.includes('Plug-in Hybrid Electric Vehicle')) return 'Hybrid';
                return 'Other';
            };

            const allYears = d3.range(d3.min(data, d => d.ModelYear), d3.max(data, d => d.ModelYear) + 1);

            const yearCounts = d3.nest()
            .key(d => d.ModelYear)
            .key(d => mapVehicleType(d.ElectricVehicleType))
            .rollup(v => v.length)
            .entries(data)
            .map(d => {
                let obj = { year: +d.key };
                d.values.forEach(v => {
                    obj[v.key] = v.value;
                });
                return obj;
            });

            const completeYearCounts = allYears.map(year => {
                const yearData = yearCounts.find(d => d.year === year);
                return yearData ? yearData : { year, EV: 0, Hybrid: 0 };
            });

            const stack = d3.stack()
                .keys(['EV', 'Hybrid']);

            const series = stack(completeYearCounts);

            console.log(completeYearCounts);

            const x1 = d3.scaleBand()
                .domain(completeYearCounts.map(d => d.year))
                .range([0, width])
                .padding(0.1);

            const y1 = d3.scaleLinear()
                .domain([0, d3.max(series, d => d3.max(d, d => d[1]))]).nice()
                .range([height, 0]);

            const color = d3.scaleOrdinal()
                .domain(['EV', 'Hybrid'])
                .range(['steelblue', 'orange']);

            const bars = svg1.selectAll(".bar-group")
                .data(series)
                .enter().append("g")
                .attr("class", "bar-group")
                .attr("fill", d => color(d.key))
                //.attr("transform", d => `translate(${x1(d.year)}, 0)`);

            bars.selectAll(".bar")
                .data(d => d)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x1(d.data.year))
                .attr("y", d => y1(d[1]))
                .attr("width", x1.bandwidth())
                .attr("height", d => y1(d[0]) - y1(d[1]))
                // .attr("fill", d => color(d.type))
                .on("mouseover", function(event, d) {
                    d3.select("#tooltip")
                        .style("display", "block")
                        .html(`Model Year: ${d.year}<br>Vehicle Count: ${d.count}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", function(event) {
                    d3.select("#tooltip")
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select("#tooltip").style("display", "none");
                });

            svg1.append("g")
                .attr("class", "x-axis")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x1).tickFormat(d3.format("d")));

            svg1.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y1));

            svg1.append("text")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)
                .attr("text-anchor", "middle")
                .text("Model Year");

            svg1.append("text")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 20)
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .text("Count of Vehicles");

            // Scene 1 legend
            const legend = svg1.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${width}, 0)`);

            const legendItems = [
                { label: 'Electric Vehicle', color: 'steelblue' },
                { label: 'Hybrid', color: 'orange' }
            ];

            legendItems.forEach((item, i) => {
                legend.append("rect")
                    .attr("x", 0)
                    .attr("y", i * 20)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", item.color);

                legend.append("text")
                    .attr("x", 30)
                    .attr("y", i * 20 + 14)
                    .text(item.label);
            });

            // Scene 2: Vehicle Counts by Model Year and Make
            const scene2 = d3.select("#scene2");

            const svg2 = scene2.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Identify top 6 makes
            const makeLabelCount = 10;  
            const makeCounts2 = d3.nest()
                .key(d => d.Make)
                .rollup(v => v.length)
                .entries(data)
                .sort((a, b) => d3.descending(a.value, b.value))
                .slice(0, makeLabelCount)
                .map(d => d.key);

            const mapMake = (make) => {
                if (makeCounts2.includes(make)) return make;
                return 'Other';
            };

            const allYears2 = d3.range(d3.min(data, d => d.ModelYear), d3.max(data, d => d.ModelYear) + 1);

            const yearCounts2 = d3.nest()
                .key(d => d.ModelYear)
                .key(d => mapMake(d.Make))
                .rollup(v => v.length)
                .entries(data)
                .map(d => {
                    let obj = { year: +d.key };
                    d.values.forEach(v => {
                        obj[v.key] = v.value;
                    });
                    return obj;
                });

            const completeYearCounts2 = allYears2.map(year => {
                const yearData = yearCounts2.find(d => d.year === year);
                const initialObj = { year };
                makeCounts2.concat('Other').forEach(make => initialObj[make] = 0);
                return yearData ? { ...initialObj, ...yearData } : initialObj;
            });

            const stack2 = d3.stack()
                .keys(makeCounts2.concat('Other'));

            const series2 = stack2(completeYearCounts2);

            console.log(completeYearCounts2);

            const x2 = d3.scaleBand()
                .domain(completeYearCounts2.map(d => d.year))
                .range([0, width])
                .padding(0.1);

            const y2 = d3.scaleLinear()
                .domain([0, d3.max(series2, d => d3.max(d, d => d[1]))]).nice()
                .range([height, 0]);

            const color2 = d3.scaleOrdinal()
                .domain(makeCounts2.concat('Other'))
                .range(d3.schemeCategory10.slice(0, makeLabelCount).concat(['#ccc']));

            const bars2 = svg2.selectAll(".bar-group")
                .data(series2)
                .enter().append("g")
                .attr("class", "bar-group")
                .attr("fill", d => color2(d.key));

            bars2.selectAll(".bar")
                .data(d => d)
                .enter().append("rect")
                .attr("x", d => x2(d.data.year))
                .attr("y", d => y2(d[1]))
                .attr("width", x2.bandwidth())
                .attr("height", d => y2(d[0]) - y2(d[1]))
                .on("mouseover", function(event, d) {
                    d3.select("#tooltip")
                        .style("display", "block")
                        .html(`Model Year: ${d.year}<br>Make: ${d.make}<br>Vehicle Count: ${d.count}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mousemove", function(event) {
                    d3.select("#tooltip")
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select("#tooltip").style("display", "none");
                });

            svg2.append("g")
                .attr("class", "x-axis")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x2).tickFormat(d3.format("d")));

            svg2.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y2));

            svg2.append("text")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)
                .attr("text-anchor", "middle")
                .text("Model Year");

            svg2.append("text")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 20)
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .text("Count of Vehicles");

            // Scene 2 legend
            const legend2 = svg2.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${width}, 0)`);

            const legendItems2 = makeCounts2.concat('Other').map((make, i) => ({ label: make, color: color2(make) }));

            legendItems2.forEach((item, i) => {
                legend2.append("rect")
                    .attr("x", 0)
                    .attr("y", i * 20)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", item.color);

                legend2.append("text")
                    .attr("x", 30)
                    .attr("y", i * 20 + 14)
                    .text(item.label);
            });

            // const makeCounts = d3.nest()
            //     .key(d => d.Make)
            //     .rollup(v => v.length)
            //     .entries(data)
            //     .map(d => ({ make: d.key, range: d.ElectricRange }));

            // const x2 = d3.scaleLinear()
            //     .domain([0, d3.max(data, d => d.ElectricRange)]).nice()
            //     .range([0, width]);

            // const y2 = d3.scaleBand()
            //     .domain(data.map(d => d.Make))
            //     .range([height, 0])
            //     .padding(0.1);

            // // const y2 = d3.scaleBand()
            // //     .domain(data.map(d => d.Make))
            // //     .range([0, height])
            // //     .padding(0.1);

            // // const x2 = d3.scaleLinear()
            // //     .domain([0, d3.max(data, d => d.ElectricRange)]).nice()
            // //     .range([width, 0]);

            // const svg2 = d3.select("#scene2").append("svg")
            //     .attr("width", width + margin.left + margin.right)
            //     .attr("height", height + margin.top + margin.bottom)
            //     .append("g")
            //     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // svg2.selectAll(".bar")
            //     .data(data)
            //     .enter().append("rect")
            //     .attr("class", "bar")
            //     .attr("y", d => y2(d.Make))
            //     .attr("x", 0)
            //     .attr("width", d => x2(d.ElectricRange))
            //     .attr("height", y2.bandwidth())
            //     .attr("fill", "steelblue");

            // svg2.append("g")
            //     .attr("class", "x-axis")
            //     .attr("transform", "translate(0," + height + ")")
            //     .call(d3.axisBottom(x2));

            // svg2.append("g")
            //     .attr("class", "y-axis")
            //     .call(d3.axisLeft(y2));

            // svg2.append("text")
            //     .attr("x", width / 2)
            //     .attr("y", height + margin.bottom)
            //     .attr("text-anchor", "middle")
            //     .text("Electric Range");

            // svg2.append("text")
            //     .attr("x", -height / 2)
            //     .attr("y", -margin.left + 20)
            //     .attr("text-anchor", "middle")
            //     .attr("transform", "rotate(-90)")
            //     .text("Make");
            // const scene2 = d3.select("#scene2");

            // const svg2 = scene2.append("svg")
            //     .attr("width", width + margin.left + margin.right)
            //     .attr("height", height + margin.top + margin.bottom)
            //     .append("g")
            //     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // const x2 = d3.scaleBand()
            //     .domain(data.map(d => d.Make))
            //     .range([0, width])
            //     .padding(0.1);

            // const y2 = d3.scaleLinear()
            //     .domain([0, d3.max(data, d => d.ElectricRange)]).nice()
            //     .range([height, 0]);

            // svg2.append("g")
            //     .selectAll(".bar")
            //     .data(data)
            //     .enter().append("rect")
            //     .attr("class", "bar")
            //     .attr("x", d => x2(d.Make))
            //     .attr("y", d => y2(d.ElectricRange))
            //     .attr("width", x2.bandwidth())
            //     .attr("height", d => height - y2(d.ElectricRange))
            //     .attr("fill", "steelblue");

            // svg2.append("g")
            //     .attr("class", "x-axis")
            //     .attr("transform", "translate(0," + height + ")")
            //     .call(d3.axisBottom(x2));

            // svg2.append("g")
            //     .attr("class", "y-axis")
            //     .call(d3.axisLeft(y2));

            // svg2.append("text")
            //     .attr("x", width / 2)
            //     .attr("y", height + margin.bottom)
            //     .attr("text-anchor", "middle")
            //     .text("Make");

            // svg2.append("text")
            //     .attr("x", -height / 2)
            //     .attr("y", -margin.left + 20)
            //     .attr("text-anchor", "middle")
            //     .attr("transform", "rotate(-90)")
            //     .text("Electric Range");

            // Scene 3: Electric Range by Model Year
            const scene3 = d3.select("#scene3");

            const svg3 = scene3.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            const filteredData = data.filter(d => d.ElectricRange > 0);

            console.log(filteredData);  

            const averageRanges = d3.nest()
                .key(d => d.ModelYear)
                .key(d => mapVehicleType(d.ElectricVehicleType))
                .rollup(v => d3.mean(v, d => d.ElectricRange))
                .entries(filteredData)
                .map(d => {
                    let obj = { year: +d.key };
                    d.values.forEach(v => {
                        obj[v.key] = v.value;
                    });
                    return obj;
            });

            const allYears3 = d3.range(d3.min(filteredData, d => d.ModelYear), d3.max(filteredData, d => d.ModelYear) + 1);

            const completeYearCounts3 = allYears3.map(year => {
                const yearData = averageRanges.find(d => d.year === year);
                return yearData ? yearData : { year, EV: 0, Hybrid: 0 };
            });

            // averageRanges.sort((a, b) => d3.ascending(a.year, b.year));

            // console.log(averageRanges);

            const x3 = d3.scaleBand()
                .domain(completeYearCounts3.map(d => d.year))
                .range([0, width])
                .padding(0.1);

            const xSubgroup = d3.scaleBand()
                .domain(["EV", "Hybrid"])
                .range([0, x3.bandwidth()])
                .padding(0.05);

            const y3 = d3.scaleLinear()
                .domain([0, d3.max(completeYearCounts3, d => Math.max(d.EV, d.Hybrid))]).nice()
                .range([height, 0]);

            const color3 = d3.scaleOrdinal()
                .domain(["EV", "Hybrid"])
                .range(["steelblue", "orange"]);

            const bars3 = svg3.selectAll(".bar-group")
                .data(completeYearCounts3)
                .enter().append("g")
                .attr("class", "bar-group")
                .attr("transform", d => "translate(" + x3(d.year) + ",0)");

            bars3.selectAll(".bar")
                .data(d => [
                    { type: "EV", averageRange: d.EV || 0 },
                    { type: "Hybrid", averageRange: d.Hybrid || 0 }
                ])
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => xSubgroup(d.type))
                .attr("y", d => y3(d.averageRange))
                .attr("width", xSubgroup.bandwidth())
                .attr("height", d => height - y3(d.averageRange))
                .attr("fill", d => color3(d.type));

            svg3.append("g")
                .attr("class", "x-axis")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x3).tickFormat(d3.format("d")));

            svg3.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y3));

            svg3.append("text")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)
                .attr("text-anchor", "middle")
                .text("Model Year");

            svg3.append("text")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 20)
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .text("Average Electric Range");

            // Scene 4: User Exploration
            const exploration = d3.select("#exploration");
            const svg4 = d3.select("#exploration-chart");
            const g = svg4.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

            const xScale = d3.scaleBand().rangeRound([0, width]).padding(0.1);
            const yScale = d3.scaleLinear().rangeRound([height, 0]);

            const xAxis = g.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${height})`);

            const yAxis = g.append("g")
                .attr("class", "y-axis");

            function updateChart() {
                const xValue = document.getElementById('x-axis').value;
                const yValue = document.getElementById('y-axis').value;

                const filteredData = data.filter(d => {
                    const yearRange = document.getElementById('year-range').value.split(',');
                    const rangeSlider = document.getElementById('range-slider').value.split(',');
                    const selectedMakes = Array.from(document.getElementById('make-dropdown').selectedOptions).map(option => option.value);
                    const selectedTypes = Array.from(document.getElementById('type-dropdown').selectedOptions).map(option => option.value);
                    const selectedModels = Array.from(document.getElementById('model-dropdown').selectedOptions).map(option => option.value);

                    return d.ModelYear >= +yearRange[0] && d.ModelYear <= +yearRange[1]
                        && d.ElectricRange >= +rangeSlider[0] && d.ElectricRange <= +rangeSlider[1]
                        && (selectedMakes.length === 0 || selectedMakes.includes(d.Make))
                        && (selectedTypes.length === 0 || selectedTypes.includes(d.ElectricVehicleType))
                        && (selectedModels.length === 0 || selectedModels.includes(d.Model));
                });

                xScale.domain(filteredData.map(d => d[xValue]));
                yScale.domain([0, d3.max(filteredData, d => d[yValue])]).nice();

                xAxis.call(d3.axisBottom(xScale));
                yAxis.call(d3.axisLeft(yScale));

                const bars = g.selectAll(".bar")
                    .data(filteredData, d => d[xValue]);

                bars.enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", d => xScale(d[xValue]))
                    .attr("y", d => yScale(d[yValue]))
                    .attr("width", xScale.bandwidth())
                    .attr("height", d => height - yScale(d[yValue]))
                    .attr("fill", "steelblue");

                bars.transition().duration(750)
                    .attr("x", d => xScale(d[xValue]))
                    .attr("y", d => yScale(d[yValue]))
                    .attr("width", xScale.bandwidth())
                    .attr("height", d => height - yScale(d[yValue]));

                bars.exit().remove();
            }

            // Populate dropdowns with unique values
            const makeOptions = Array.from(new Set(data.map(d => d.Make)));
            makeOptions.forEach(make => {
                d3.select("#make-dropdown").append("option").attr("value", make).text(make);
            });

            const modelOptions = Array.from(new Set(data.map(d => d.Model)));
            modelOptions.forEach(model => {
                d3.select("#model-dropdown").append("option").attr("value", model).text(model);
            });

            // Add event listeners to update chart on change
            document.getElementById('x-axis').addEventListener('change', updateChart);
            document.getElementById('y-axis').addEventListener('change', updateChart);
            document.getElementById('year-range').addEventListener('change', updateChart);
            document.getElementById('range-slider').addEventListener('change', updateChart);
            document.getElementById('make-dropdown').addEventListener('change', updateChart);
            document.getElementById('type-dropdown').addEventListener('change', updateChart);
            document.getElementById('model-dropdown').addEventListener('change', updateChart);

            // Initial chart update
            updateChart();
            // const svg4 = exploration.append("svg")
            //     .attr("width", width + margin.left + margin.right)
            //     .attr("height", height + margin.top + margin.bottom)
            //     .append("g")
            //     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // const x4 = d3.scaleBand()
            //     .domain(data.map(d => d.Model))
            //     .range([0, width])
            //     .padding(0.1);

            // const y4 = d3.scaleLinear()
            //     .domain([0, d3.max(data, d => d.ElectricRange)]).nice()
            //     .range([height, 0]);

            // svg4.append("g")
            //     .selectAll(".bar")
            //     .data(data)
            //     .enter().append("rect")
            //     .attr("class", "bar")
            //     .attr("x", d => x4(d.Model))
            //     .attr("y", d => y4(d.ElectricRange))
            //     .attr("width", x4.bandwidth())
            //     .attr("height", d => height - y4(d.ElectricRange))
            //     .attr("fill", "steelblue");

            // svg4.append("g")
            //     .attr("class", "x-axis")
            //     .attr("transform", "translate(0," + height + ")")
            //     .call(d3.axisBottom(x4));

            // svg4.append("g")
            //     .attr("class", "y-axis")
            //     .call(d3.axisLeft(y4));

            // svg4.append("text")
            //     .attr("x", width / 2)
            //     .attr("y", height + margin.bottom)
            //     .attr("text-anchor", "middle")
            //     .text("Model");

            // svg4.append("text")
            //     .attr("x", -height / 2)
            //     .attr("y", -margin.left + 20)
            //     .attr("text-anchor", "middle")
            //     .attr("transform", "rotate(-90)")
            //     .text("Electric Range");
        });
    </script>
    <script>
        let currentScene = 0;
        const scenes = document.querySelectorAll('.scene');
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');

        function showScene(index) {
            scenes.forEach((scene, i) => {
                scene.classList.toggle('active', i === index);
            });
            prevBtn.style.display = index === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = index === scenes.length - 1 ? 'none' : 'inline-block';
        }

        function nextScene() {
            if (currentScene < scenes.length - 1) {
                currentScene++;
                showScene(currentScene);
            }
        }

        function prevScene() {
            if (currentScene > 0) {
                currentScene--;
                showScene(currentScene);
            }
        }

        // Initialize
        showScene(currentScene);
    </script>
</body>
</html>